{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _syncStorage = _interopRequireDefault(require(\"sync-storage\"));\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } it = o[typeof Symbol === \"function\" ? Symbol.iterator : \"@@iterator\"](); return it.next.bind(it); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nvar CouponProvider = {\n  lineItemTotalService: function lineItemTotalService(lineItems) {\n    var total = 0;\n\n    for (var _iterator = _createForOfIteratorHelperLoose(lineItems), _step; !(_step = _iterator()).done;) {\n      var value = _step.value;\n      var subtotal = parseFloat(value.total);\n      total += subtotal;\n    }\n\n    return total;\n  },\n  checkOnSaleService: function checkOnSaleService(lineItems, coupon) {\n    if (coupon.exclude_sale_items == 0 || coupon.exclude_sale_items == '') {\n      return false;\n    }\n\n    var found = false;\n    lineItems.some(function (value, index) {\n      if (value.on_sale == true) {\n        found = true;\n      }\n    });\n\n    if (found && coupon.discount_type == 'fixed_cart') {\n      return true;\n    } else if (found && coupon.discount_type == 'percent') {\n      return true;\n    }\n\n    return false;\n  },\n  emailCheckService: function emailCheckService(emailList) {\n    if (emailList.length === 0) return false;\n    var found = false;\n\n    for (var _iterator2 = _createForOfIteratorHelperLoose(emailList), _step2; !(_step2 = _iterator2()).done;) {\n      var value = _step2.value;\n\n      if (value === _syncStorage.default.get('customerData').email) {\n        found = true;\n        return true;\n      }\n    }\n\n    return found;\n  },\n  checkCategoriesService: function checkCategoriesService(value, coupon) {\n    if (coupon.product_categories.length === 0 && coupon.excluded_product_categories.length === 0) {\n      return true;\n    }\n\n    var categoryId = value.categories_id;\n    var found = 0;\n\n    for (var _iterator3 = _createForOfIteratorHelperLoose(coupon.product_categories), _step3; !(_step3 = _iterator3()).done;) {\n      var y = _step3.value;\n\n      if (categoryId == y) {\n        found++;\n      }\n    }\n\n    if (coupon.product_categories.length === 0) {\n      found++;\n    }\n\n    var found2 = 0;\n\n    for (var _iterator4 = _createForOfIteratorHelperLoose(coupon.excluded_product_categories), _step4; !(_step4 = _iterator4()).done;) {\n      var _y = _step4.value;\n\n      if (categoryId == _y) {\n        found2++;\n      }\n    }\n\n    if (found != 0 && found2 == 0) {\n      return true;\n    }\n\n    return false;\n  },\n  couponApplyOnProductService: function couponApplyOnProductService(value, coupon) {\n    if (coupon.product_ids.length === 0 && coupon.exclude_product_ids.length === 0) {\n      return true;\n    }\n\n    var id = value.products_id;\n    var found = 0;\n\n    for (var _iterator5 = _createForOfIteratorHelperLoose(coupon.product_ids), _step5; !(_step5 = _iterator5()).done;) {\n      var _value = _step5.value;\n\n      if (id == _value) {\n        found++;\n        return true;\n      }\n    }\n\n    if (coupon.product_ids.length === 0) {\n      found++;\n    }\n\n    var found2 = 0;\n\n    for (var _iterator6 = _createForOfIteratorHelperLoose(coupon.exclude_product_ids), _step6; !(_step6 = _iterator6()).done;) {\n      var _value2 = _step6.value;\n\n      if (id == _value2) {\n        found2++;\n        return true;\n      }\n    }\n\n    if (found != 0 && found2 == 0) {\n      return true;\n    }\n\n    return false;\n  },\n  checkAlreadyAppliedService: function checkAlreadyAppliedService(coupon, couponLines) {\n    if (couponLines.length === 0) return false;\n    var found = false;\n\n    for (var _iterator7 = _createForOfIteratorHelperLoose(couponLines), _step7; !(_step7 = _iterator7()).done;) {\n      var value = _step7.value;\n\n      if (value.code == coupon.code) {\n        found = true;\n      }\n    }\n\n    return found;\n  },\n  checkUserUsageService: function checkUserUsageService(coupon) {\n    if (coupon.used_by.length === 0) return false;\n    if (coupon.usage_limit == null && coupon.usage_limit_per_user == null) return false;\n\n    if (coupon.usage_limit == 0) {} else if (coupon.usage_count >= coupon.usage_limit) return true;\n\n    var id = _syncStorage.default.get('customerData').email;\n\n    if (_syncStorage.default.get('customerData') != null) {\n      var id2 = _syncStorage.default.get('customerData').customers_id;\n    }\n\n    var count = 0;\n\n    for (var _iterator8 = _createForOfIteratorHelperLoose(coupon.used_by), _step8; !(_step8 = _iterator8()).done;) {\n      var value = _step8.value;\n      if (value == id || value == id2) count++;\n    }\n\n    if (count >= coupon.usage_limit_per_user) {\n      return true;\n    } else {\n      return false;\n    }\n  },\n  checkNoItemInCartService: function checkNoItemInCartService(lineItems, coupon) {\n    var productIds = coupon.product_ids;\n    var ExProductIds = coupon.exclude_product_ids;\n    var pCategory = coupon.product_categories;\n    var ExPCategory = coupon.excluded_product_categories;\n\n    if (productIds.length === 0 && ExProductIds.length === 0 && pCategory.length === 0 && ExPCategory.length === 0) {\n      return true;\n    }\n\n    var result = false;\n\n    if (productIds.length !== 0) {\n      for (var _iterator9 = _createForOfIteratorHelperLoose(lineItems), _step9; !(_step9 = _iterator9()).done;) {\n        var x = _step9.value;\n        var id = x.products_id;\n        var vId = -1;\n        if (x.variation_id !== undefined) vId = x.variation_id;\n\n        for (var _iterator10 = _createForOfIteratorHelperLoose(productIds), _step10; !(_step10 = _iterator10()).done;) {\n          var y = _step10.value;\n\n          if (id == y || vId == y) {\n            result = true;\n          }\n        }\n      }\n    } else {\n      result = true;\n    }\n\n    if (ExProductIds.length != 0) {\n      for (var _iterator11 = _createForOfIteratorHelperLoose(lineItems), _step11; !(_step11 = _iterator11()).done;) {\n        var _x = _step11.value;\n        var _id = _x.products_id;\n\n        var _vId = -1;\n\n        if (_x.variation_id != undefined) _vId = _x.variation_id;\n\n        for (var _iterator12 = _createForOfIteratorHelperLoose(ExProductIds), _step12; !(_step12 = _iterator12()).done;) {\n          var _y2 = _step12.value;\n\n          if (_id == _y2 || _vId == _y2) {\n            result = false;\n          }\n        }\n      }\n    }\n\n    var result2 = false;\n\n    if (pCategory.length != 0) {\n      for (var _iterator13 = _createForOfIteratorHelperLoose(lineItems), _step13; !(_step13 = _iterator13()).done;) {\n        var w = _step13.value;\n\n        for (var _iterator14 = _createForOfIteratorHelperLoose(w.categories), _step14; !(_step14 = _iterator14()).done;) {\n          var _x2 = _step14.value;\n\n          for (var _iterator15 = _createForOfIteratorHelperLoose(pCategory), _step15; !(_step15 = _iterator15()).done;) {\n            var _y3 = _step15.value;\n\n            if (_x2.id == _y3) {\n              result2 = true;\n            }\n          }\n        }\n      }\n    } else {\n      result2 = true;\n    }\n\n    if (ExPCategory.length != 0) {\n      for (var _iterator16 = _createForOfIteratorHelperLoose(lineItems), _step16; !(_step16 = _iterator16()).done;) {\n        var _w = _step16.value;\n\n        for (var _iterator17 = _createForOfIteratorHelperLoose(_w.categories), _step17; !(_step17 = _iterator17()).done;) {\n          var _x3 = _step17.value;\n\n          for (var _iterator18 = _createForOfIteratorHelperLoose(pCategory), _step18; !(_step18 = _iterator18()).done;) {\n            var _y4 = _step18.value;\n\n            if (_x3.id == _y4) {\n              result2 = false;\n            }\n          }\n        }\n      }\n    }\n\n    if (result == true && result2 == true && coupon.discount_type != 'fixed_cart') {\n      return true;\n    } else if (result == true && result2 == true && coupon.discount_type != 'percent') {\n      return true;\n    } else if (result == true && result2 == false && coupon.discount_type == 'fixed_product') {\n      return true;\n    } else if (result == true && result2 == false && coupon.discount_type == 'percent_product') {\n      return true;\n    } else if (result == false && result2 == true && coupon.discount_type == 'percent_product') {\n      return true;\n    } else if (result == false && result2 == true && coupon.discount_type == 'fixed_product') {\n      return true;\n    }\n\n    return false;\n  },\n  validateCouponService: function validateCouponService(toast, coupon, lineItems, couponLines) {\n    var expDate = new Date(coupon.expiry_date);\n    var todayDate = new Date();\n\n    if (expDate <= todayDate && coupon.expiry_date != null) {\n      toast.show('Sorry Coupon is Expired');\n      return false;\n    } else if (this.lineItemTotalService(lineItems) <= coupon.minimum_amount) {\n        toast.show('Sorry your Cart total is low than coupon min limit!');\n        return false;\n      } else if (this.lineItemTotalService(lineItems) >= coupon.maximum_amount && coupon.maximum_amount != 0) {\n          toast.show('Sorry your Cart total is Higher than coupon Max limit!');\n          return false;\n        } else if (this.emailCheckService(coupon.email_restrictions) == true) {\n          toast.show('Sorry, this coupon is not valid for this email address!');\n          return false;\n        } else if (this.checkOnSaleService(lineItems, coupon) == true) {\n            toast.show('Sorry, this coupon is not valid for sale items.');\n            return false;\n          } else if (this.checkAlreadyAppliedService(coupon, couponLines) == true) {\n            toast.show('Coupon code already applied!');\n            return false;\n          } else if (couponLines != 0 && couponLines[0].individual_use == true) {\n            toast.show('Sorry Individual Use Coupon is already applied any other coupon cannot be applied with it !');\n            return false;\n          } else if (this.checkUserUsageService(coupon) == true) {\n            toast.show('Coupon usage limit has been reached.');\n            return false;\n          }\n\n    return true;\n  },\n  apply: function apply(coupon, lineItems) {\n    var _this = this;\n\n    var productLimit = coupon.limit_usage_to_x_items;\n    if (productLimit == 0) productLimit = null;\n    var productqtyflag = 0;\n\n    if (coupon.discount_type == 'fixed_cart') {\n      var cartTotal = parseFloat(this.lineItemTotalService(lineItems));\n      var discount = parseFloat((coupon.amount / cartTotal).toString());\n      lineItems.forEach(function (value, index) {\n        var result = value.total - parseFloat((discount * value.total).toString());\n        if (result < 0) result = 0;\n        value.total = result;\n      });\n      return lineItems;\n    } else if (coupon.discount_type == 'percent') {\n      lineItems.forEach(function (value, index) {\n        var amount = parseFloat(coupon.amount);\n        var subtotal = parseFloat(value.subtotal);\n        var total = parseFloat(value.total);\n        var discount = subtotal / 100 * amount;\n        value.total = parseFloat((total - discount).toString());\n        if (value.total < 0) value.total = 0;\n      });\n      return lineItems;\n    } else if (coupon.discount_type == 'fixed_product') {\n      var amount = parseFloat(coupon.amount);\n      lineItems.forEach(function (value, index) {\n        if (_this.couponApplyOnProductService(value, coupon) && _this.checkCategoriesService(value, coupon)) {\n          var quantity = value.customers_basket_quantity;\n          var total = parseFloat(value.total);\n\n          if (productLimit > 0) {\n            for (var l = 1; l <= quantity; l++) {\n              if (productqtyflag < productLimit) {\n                total = parseFloat((total - amount).toString());\n                productqtyflag += 1;\n              }\n            }\n\n            value.total = total;\n          } else {\n            value.total = parseFloat((total - amount * quantity).toString());\n          }\n\n          if (value.total < 0) {\n            value.total = 0;\n          }\n        }\n      });\n      return lineItems;\n    } else if (coupon.discount_type == 'percent_product') {\n      var _amount = parseFloat(coupon.amount);\n\n      lineItems.forEach(function (value, index) {\n        if (_this.couponApplyOnProductService(value, coupon) && _this.checkCategoriesService(value, coupon)) {\n          var total = parseFloat(value.total);\n\n          if (productLimit > 0) {\n            for (var l = 1; l <= value.customers_basket_quantity; l++) {\n              var _discount = parseFloat((value.price / 100 * _amount).toString());\n\n              if (productqtyflag < productLimit) {\n                total = parseFloat((total - _discount).toString());\n                productqtyflag += 1;\n              }\n            }\n\n            value.total = total;\n          } else {\n            value.total = parseFloat((total - total / 100 * _amount).toString());\n          }\n\n          if (value.total < 0) value.total = 0;\n        }\n      });\n      return lineItems;\n    }\n  }\n};\nvar _default = CouponProvider;\nexports.default = _default;","map":{"version":3,"sources":["C:/Users/mysiew/Documents/eCommerce/codecanyon-xPJMYS8x-react-native-delivery-solution-with-advance-website-and-cms/SourceCode/vesend-consumer-app-master/src/common/CouponClass.js"],"names":["CouponProvider","lineItemTotalService","lineItems","total","value","subtotal","parseFloat","checkOnSaleService","coupon","exclude_sale_items","found","some","index","on_sale","discount_type","emailCheckService","emailList","length","SyncStorage","get","email","checkCategoriesService","product_categories","excluded_product_categories","categoryId","categories_id","y","found2","couponApplyOnProductService","product_ids","exclude_product_ids","id","products_id","checkAlreadyAppliedService","couponLines","code","checkUserUsageService","used_by","usage_limit","usage_limit_per_user","usage_count","id2","customers_id","count","checkNoItemInCartService","productIds","ExProductIds","pCategory","ExPCategory","result","x","vId","variation_id","undefined","result2","w","categories","validateCouponService","toast","expDate","Date","expiry_date","todayDate","show","minimum_amount","maximum_amount","email_restrictions","individual_use","apply","productLimit","limit_usage_to_x_items","productqtyflag","cartTotal","discount","amount","toString","forEach","quantity","customers_basket_quantity","l","price"],"mappings":"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","sourcesContent":["import SyncStorage from 'sync-storage'\nconst CouponProvider = {\n  // <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< All below services are used for coupon >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  lineItemTotalService (lineItems) {\n    let total = 0\n    for (const value of lineItems) {\n      const subtotal = parseFloat(value.total)\n      total += subtotal\n    }\n    return total\n  },\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  checkOnSaleService (lineItems, coupon) {\n    if (coupon.exclude_sale_items == 0 || coupon.exclude_sale_items == '') { return false }\n    let found = false\n    lineItems.some((value, index) => { /// ////////////////////////////////////\n      if (value.on_sale == true) { found = true }\n    })\n    if (found && coupon.discount_type == 'fixed_cart') { return true } else if (found && coupon.discount_type == 'percent') { return true }\n    return false\n  },\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  emailCheckService (emailList) {\n    if (emailList.length === 0) return false\n    let found = false\n    for (const value of emailList) {\n      if (value === SyncStorage.get('customerData').email) {\n        found = true\n        return true\n      }\n    }\n    return found\n  },\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  checkCategoriesService (value, coupon) {\n    if (coupon.product_categories.length === 0 && coupon.excluded_product_categories.length === 0) { return true }\n    var categoryId = value.categories_id\n    let found = 0\n    for (const y of coupon.product_categories) {\n      if (categoryId == y) { found++ }\n      // }\n    }\n    if (coupon.product_categories.length === 0) {\n      found++\n    }\n    let found2 = 0\n    for (const y of coupon.excluded_product_categories) {\n      if (categoryId == y) { found2++ }\n    }\n    if (found != 0 && found2 == 0) { return true }\n    return false\n  },\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  couponApplyOnProductService (value, coupon) {\n    if (coupon.product_ids.length === 0 && coupon.exclude_product_ids.length === 0) { return true }\n    const id = value.products_id\n    let found = 0\n    // checking in allowed products\n    for (const value of coupon.product_ids) {\n      if (id == value) {\n        found++\n        return true\n      }\n    }\n    if (coupon.product_ids.length === 0) {\n      found++\n    }\n    let found2 = 0\n    // checking in excluded products\n    for (const value of coupon.exclude_product_ids) {\n      if (id == value) {\n        found2++\n        return true\n      }\n    }\n    if (found != 0 && found2 == 0) {\n      return true\n    }\n    return false\n  },\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  checkAlreadyAppliedService (coupon, couponLines) {\n    if (couponLines.length === 0) return false\n    let found = false\n    for (const value of couponLines) {\n      if (value.code == coupon.code) { found = true }\n    }\n    return found\n  },\n  //= =======================================================================================================\n  //= ============================== service to calculate line items total ==============================\n  checkUserUsageService (coupon) {\n    if (coupon.used_by.length === 0) return false\n    if (coupon.usage_limit == null && coupon.usage_limit_per_user == null) return false\n    if (coupon.usage_limit == 0) { } else if (coupon.usage_count >= coupon.usage_limit) return true\n    const id = SyncStorage.get('customerData').email\n    if (SyncStorage.get('customerData') != null) { var id2 = SyncStorage.get('customerData').customers_id }\n    let count = 0\n    for (const value of coupon.used_by) {\n      if (value == id || value == id2) count++\n    }\n    if (count >= coupon.usage_limit_per_user) { return true } else { return false }\n  },\n  //= =======================================================================================================\n  //= ============================== service to check ==============================\n  checkNoItemInCartService (lineItems, coupon) {\n    const productIds = coupon.product_ids\n    const ExProductIds = coupon.exclude_product_ids\n    const pCategory = coupon.product_categories\n    const ExPCategory = coupon.excluded_product_categories\n\n    if (productIds.length === 0 && ExProductIds.length === 0 && pCategory.length === 0 && ExPCategory.length === 0) { return true }\n    let result = false\n    if (productIds.length !== 0) {\n      for (const x of lineItems) { // upper loop\n        const id = x.products_id; let vId = -1\n        if (x.variation_id !== undefined) vId = x.variation_id\n        for (const y of productIds) { // lower loop\n          if (id == y || vId == y) { result = true }\n        }\n      }\n    } else { result = true }\n    // checking in excluded products ids\n    if (ExProductIds.length != 0) {\n      for (const x of lineItems) { // upper loop\n        const id = x.products_id; let vId = -1\n        if (x.variation_id != undefined) vId = x.variation_id\n        for (const y of ExProductIds) { // lower loop\n          if (id == y || vId == y) { result = false }\n        }\n      }\n    }\n    let result2 = false\n    if (pCategory.length != 0) {\n      for (const w of lineItems) { // upper loop\n        for (const x of w.categories) { // midddle loop\n          for (const y of pCategory) { // lower loop\n            if (x.id == y) { result2 = true }\n          }\n        }\n      }\n    } else { result2 = true }\n    if (ExPCategory.length != 0) {\n      for (const w of lineItems) { // upper loop\n        for (const x of w.categories) { // midddle loop\n          for (const y of pCategory) { // lower loop\n            if (x.id == y) { result2 = false }\n          }\n        }\n      }\n    }\n    if (result == true && result2 == true && coupon.discount_type != 'fixed_cart') { return true } else if (result == true && result2 == true && coupon.discount_type != 'percent') { return true } else if (result == true && result2 == false && coupon.discount_type == 'fixed_product') { return true } else if (result == true && result2 == false && coupon.discount_type == 'percent_product') { return true } else if (result == false && result2 == true && coupon.discount_type == 'percent_product') { return true } else if (result == false && result2 == true && coupon.discount_type == 'fixed_product') { return true }\n    return false\n  },\n  //= =======================================================================================================\n  //= ============================== service to check coupon will apply on cart or not  ==============================\n\n  //= =======================================================================================================\n  //= ============================== service to check the validity of coupon  ==============================\n  validateCouponService (toast, coupon, lineItems, couponLines) {\n    const expDate = new Date(coupon.expiry_date)\n    const todayDate = new Date()\n    // checking coupon expire or not\n    if (expDate <= todayDate && coupon.expiry_date != null) {\n      // this.alert.show('Sorry Coupon is Expired');\n      // alert('Sorry Coupon is Expired');\n      toast.show('Sorry Coupon is Expired')\n      return false\n    }\n    // if cart amount is lower than the coupon minimum limit\n    else if (this.lineItemTotalService(lineItems) <= coupon.minimum_amount) {\n      // alert('Sorry your Cart total is low than coupon min limit!');\n      toast.show('Sorry your Cart total is low than coupon min limit!')\n      // this.alert.show('Sorry your Cart total is low than coupon min limit!');\n      return false\n    }\n    // if cart amount is higher than the coupon minimum limit\n    else if (this.lineItemTotalService(lineItems) >= coupon.maximum_amount && coupon.maximum_amount != 0) {\n      // alert('Sorry your Cart total is Higher than coupon Max limit!');\n      toast.show('Sorry your Cart total is Higher than coupon Max limit!')\n      // this.alert.show('Sorry your Cart total is Higher than coupon Max limit!');\n      return false\n    } else if (this.emailCheckService(coupon.email_restrictions) == true) {\n      // alert('Sorry, this coupon is not valid for this email address!');\n      toast.show('Sorry, this coupon is not valid for this email address!')\n      //  this.alert.show('Sorry, this coupon is not valid for this email address!');\n      return false\n    }\n    //= ============================================================= further checking\n    else if (this.checkOnSaleService(lineItems, coupon) == true) {\n      // alert('Sorry, this coupon is not valid for sale items.');\n      toast.show('Sorry, this coupon is not valid for sale items.')\n      // this.alert.show('Sorry, this coupon is not valid for sale items.');\n      return false\n    } else if (this.checkAlreadyAppliedService(coupon, couponLines) == true) {\n      // alert('Coupon code already applied!');\n      toast.show('Coupon code already applied!')\n      // this.alert.show('Coupon code already applied!');\n      return false\n    } else if (couponLines != 0 && couponLines[0].individual_use == true) {\n      // alert('Sorry Individual Use Coupon is already applied any other coupon cannot be applied with it !');\n      toast.show('Sorry Individual Use Coupon is already applied any other coupon cannot be applied with it !')\n      // this.alert.show('Sorry Individual Use Coupon is already applied any other coupon cannot be applied with it !');\n      return false\n    } else if (this.checkUserUsageService(coupon) == true) {\n      //  alert('Coupon usage limit has been reached.');\n      toast.show('Coupon usage limit has been reached.')\n      // this.alert.show('Coupon usage limit has been reached.');\n      return false\n    }\n    return true\n  },\n  //= =======================================================================================================\n  //= ============================== service to apply check coupon ==============================\n\n  apply (coupon, lineItems) {\n    let productLimit = coupon.limit_usage_to_x_items\n    if (productLimit == 0) productLimit = null\n    let productqtyflag = 0\n    if (coupon.discount_type == 'fixed_cart') {\n      const cartTotal = parseFloat(this.lineItemTotalService(lineItems))\n      const discount = parseFloat((coupon.amount / cartTotal).toString())\n      lineItems.forEach((value, index) => {\n        let result = value.total - parseFloat((discount * value.total).toString())\n        if (result < 0) result = 0\n        value.total = result\n      })\n      return lineItems\n    } else if (coupon.discount_type == 'percent') {\n      lineItems.forEach((value, index) => {\n        const amount = parseFloat(coupon.amount)\n        const subtotal = parseFloat(value.subtotal)\n        const total = parseFloat(value.total)\n        const discount = (subtotal / 100) * amount\n        value.total = parseFloat((total - discount).toString())\n        if (value.total < 0) value.total = 0\n      })\n      return lineItems\n    } else if (coupon.discount_type == 'fixed_product') {\n      const amount = parseFloat(coupon.amount)\n      lineItems.forEach((value, index) => {\n        if (this.couponApplyOnProductService(value, coupon) && this.checkCategoriesService(value, coupon)) {\n          const quantity = value.customers_basket_quantity\n          let total = parseFloat(value.total)\n          if (productLimit > 0) {\n            for (let l = 1; l <= quantity; l++) {\n              if (productqtyflag < productLimit) {\n                total = parseFloat((total - amount).toString())\n                productqtyflag += 1\n              }\n            }\n            value.total = total\n          } else {\n            value.total = parseFloat((total - (amount * quantity)).toString())\n          }\n          if (value.total < 0) { value.total = 0 }\n        }\n      })\n      return lineItems\n    } else if (coupon.discount_type == 'percent_product') {\n      const amount = parseFloat(coupon.amount)\n      lineItems.forEach((value, index) => {\n        if (this.couponApplyOnProductService(value, coupon) && this.checkCategoriesService(value, coupon)) {\n          let total = parseFloat(value.total)\n          if (productLimit > 0) {\n            for (let l = 1; l <= value.customers_basket_quantity; l++) {\n              const discount = parseFloat(((value.price / 100) * amount).toString())\n              if (productqtyflag < productLimit) {\n                total = parseFloat((total - discount).toString())\n                productqtyflag += 1\n              }\n            }\n            value.total = total\n          } else {\n            value.total = parseFloat((total - (total / 100) * amount).toString())\n          }\n\n          if (value.total < 0) value.total = 0\n        }\n      })\n      return lineItems\n    }\n  }\n}\nexport default CouponProvider\n"]},"metadata":{},"sourceType":"script"}